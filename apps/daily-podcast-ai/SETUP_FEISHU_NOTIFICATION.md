# é£ä¹¦é€šçŸ¥é…ç½®æŒ‡å—

> æ’­å®¢ç”Ÿæˆå®Œæˆåï¼Œè‡ªåŠ¨å‘é€é£ä¹¦å¡ç‰‡é€šçŸ¥

---

## å¿«é€Ÿé…ç½®ï¼ˆ5åˆ†é’Ÿï¼‰

### ç¬¬1æ­¥ï¼šåˆ›å»ºé£ä¹¦åº”ç”¨ï¼ˆ3åˆ†é’Ÿï¼‰

1. **è®¿é—®é£ä¹¦å¼€æ”¾å¹³å°**
   ```bash
   open https://open.feishu.cn/app
   ```

2. **åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨**
   - ç‚¹å‡»ã€Œåˆ›å»ºåº”ç”¨ã€
   - åº”ç”¨åç§°: `æ’­å®¢é€šçŸ¥æœºå™¨äºº`
   - åº”ç”¨æè¿°: `æ¯æ—¥æ’­å®¢ç”Ÿæˆå®Œæˆåè‡ªåŠ¨æ¨é€é€šçŸ¥`
   - ä¸Šä¼ åº”ç”¨å›¾æ ‡ï¼ˆå¯é€‰ï¼‰

3. **å¼€é€šæƒé™**
   - å·¦ä¾§èœå• â†’ æƒé™ç®¡ç†
   - æœç´¢å¹¶å¼€é€šä»¥ä¸‹æƒé™ï¼š
     - âœ… `im:message` (å‘é€æ¶ˆæ¯)
     - âœ… `im:message:send_as_bot` (ä»¥åº”ç”¨èº«ä»½å‘æ¶ˆæ¯)

4. **è·å–å‡­è¯**
   - å·¦ä¾§èœå• â†’ å‡­è¯ä¸åŸºç¡€ä¿¡æ¯
   - å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
     - **App ID**: `cli_xxxxxxxxxx`
     - **App Secret**: `xxxxxxxxxxxxxxxx`

### ç¬¬2æ­¥ï¼šè·å–æ¥æ”¶è€… Open IDï¼ˆ2åˆ†é’Ÿï¼‰

**æ–¹æ³•1ï¼šé€šè¿‡é€šè®¯å½•ï¼ˆæ¨èï¼‰**
```bash
# 1. è¿›å…¥é£ä¹¦å¼€æ”¾å¹³å°
open https://open.feishu.cn/app

# 2. é€‰æ‹©ä½ çš„åº”ç”¨ â†’ å¼€å‘é…ç½® â†’ é€šè®¯å½•æƒé™
# 3. æ·»åŠ æƒé™: contact:user:read
# 4. ä½¿ç”¨æµ‹è¯•å·¥å…·:
#    å·¦ä¾§èœå• â†’ API è°ƒè¯• â†’ contact/v3/users/batch_get_id
#    è¾“å…¥ä½ çš„é‚®ç®±æˆ–æ‰‹æœºå·ï¼Œè·å– open_id
```

**æ–¹æ³•2ï¼šé€šè¿‡æœºå™¨äººå¯¹è¯ï¼ˆæ›´ç®€å•ï¼‰**
```bash
# 1. å·¦ä¾§èœå• â†’ å‘å¸ƒè®¾ç½® â†’ ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ
# 2. åˆ›å»ºç‰ˆæœ¬ â†’ ç”³è¯·å‘å¸ƒï¼ˆå†…éƒ¨ä½¿ç”¨ï¼Œæ— éœ€å®¡æ ¸ï¼‰
# 3. åœ¨é£ä¹¦å®¢æˆ·ç«¯æœç´¢ã€Œæ’­å®¢é€šçŸ¥æœºå™¨äººã€
# 4. ç»™æœºå™¨äººå‘é€ä»»æ„æ¶ˆæ¯
# 5. å¼€æ”¾å¹³å° â†’ äº‹ä»¶ä¸å›è°ƒ â†’ æ¶ˆæ¯äº‹ä»¶
#    æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰¾åˆ° sender.sender_id.open_id
```

**æ–¹æ³•3ï¼šä½¿ç”¨è„šæœ¬è·å–ï¼ˆæœ€å¿«ï¼‰**
```python
# åˆ›å»ºä¸´æ—¶è„šæœ¬ get_openid.py
import os
from dotenv import load_dotenv
import httpx
import asyncio

load_dotenv()

async def get_open_id_by_mobile(mobile: str):
    """é€šè¿‡æ‰‹æœºå·è·å– open_id"""
    app_id = os.getenv("FEISHU_APP_ID")
    app_secret = os.getenv("FEISHU_APP_SECRET")

    # è·å– token
    async with httpx.AsyncClient() as client:
        token_resp = await client.post(
            "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal",
            json={"app_id": app_id, "app_secret": app_secret}
        )
        token = token_resp.json()["tenant_access_token"]

        # æŸ¥è¯¢ç”¨æˆ·
        user_resp = await client.post(
            "https://open.feishu.cn/open-apis/contact/v3/users/batch_get_id",
            headers={"Authorization": f"Bearer {token}"},
            json={"mobiles": [mobile]}
        )

        result = user_resp.json()
        if result["code"] == 0:
            open_id = result["data"]["user_list"][0]["user_id"]
            print(f"âœ… Open ID: {open_id}")
            return open_id
        else:
            print(f"âŒ æŸ¥è¯¢å¤±è´¥: {result}")

# è¿è¡Œ
asyncio.run(get_open_id_by_mobile("+8613800138000"))  # æ›¿æ¢ä¸ºä½ çš„æ‰‹æœºå·
```

### ç¬¬3æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ1åˆ†é’Ÿï¼‰

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ›¿æ¢å ä½ç¬¦ï¼š

```bash
# é£ä¹¦é€šçŸ¥é…ç½®
FEISHU_APP_ID=cli_ä½ çš„app_id
FEISHU_APP_SECRET=ä½ çš„secret
FEISHU_RECEIVER_OPEN_ID=ou_ä½ çš„open_id
```

### ç¬¬4æ­¥ï¼šæµ‹è¯•é€šçŸ¥ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
# æ‰‹åŠ¨æµ‹è¯•é£ä¹¦é€šçŸ¥
python scripts/notify_feishu.py \
    --date 2026-01-15 \
    --article-count 10

# é¢„æœŸè¾“å‡º:
# âœ… è·å–é£ä¹¦ token æˆåŠŸ
# ğŸ“¤ å‘é€é£ä¹¦é€šçŸ¥: ğŸ™ï¸ ä»Šæ—¥ç§‘æŠ€æ—©æŠ¥å·²å‘å¸ƒ
# âœ… é£ä¹¦æ¶ˆæ¯å‘é€æˆåŠŸ: message_id=om_xxxxx
# ğŸ‰ é€šçŸ¥å‘é€æˆåŠŸ!

# æ£€æŸ¥é£ä¹¦å®¢æˆ·ç«¯æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯
```

---

## é€šçŸ¥å†…å®¹ç¤ºä¾‹

é£ä¹¦ä¼šæ”¶åˆ°ä¸€å¼ è“è‰²å¡ç‰‡æ¶ˆæ¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ™ï¸ ä»Šæ—¥ç§‘æŠ€æ—©æŠ¥å·²å‘å¸ƒ               â”‚ (è“è‰²å¤´éƒ¨)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ“… æ—¥æœŸ: 2026-01-15                â”‚
â”‚  ğŸ“° å†…å®¹: ç²¾é€‰ 10 ç¯‡ç§‘æŠ€æ–°é—»        â”‚
â”‚                                     â”‚
â”‚  ğŸ“¢ å‘å¸ƒçŠ¶æ€:                       â”‚
â”‚  - âœ… å†…å®¹ç”Ÿæˆå®Œæˆ                  â”‚
â”‚  - ğŸ“ æ–‡ä»¶è·¯å¾„: output/2026-01-15/ â”‚
â”‚                                     â”‚
â”‚  ğŸ“‚ ç”Ÿæˆæ–‡ä»¶:                       â”‚
â”‚  - ğŸ™ï¸ podcast-2026-01-15.mp3      â”‚
â”‚  - ğŸ–¼ï¸ cover-2026-01-15.png        â”‚
â”‚  - ğŸ“ script-2026-01-15.md        â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è‡ªåŠ¨åŒ–æµç¨‹

é…ç½®å®Œæˆåï¼Œæ¯å¤©æ—©ä¸Š 7 ç‚¹è‡ªåŠ¨æ‰§è¡Œï¼š

```
1. ç”Ÿæˆæ’­å®¢ (scripts/daily_generate.py)
   â†“
2. ç”Ÿæˆå°é¢ (scripts/generate_cover.py)
   â†“
3. å‘é€é£ä¹¦é€šçŸ¥ âœ… æ–°å¢
   â†“
4. ä½ æ”¶åˆ°é€šçŸ¥åæ‰‹åŠ¨ä¸Šä¼ /å‘å¸ƒ
```

---

## å¸¸è§é—®é¢˜

### Q1: é£ä¹¦é€šçŸ¥æ˜¯å¦å¿…éœ€ï¼Ÿ
**A**: ä¸æ˜¯ã€‚å¦‚æœä¸é…ç½®ï¼Œæ’­å®¢æ­£å¸¸ç”Ÿæˆï¼Œåªæ˜¯ä¸ä¼šæ”¶åˆ°æé†’ã€‚

### Q2: èƒ½å‘é€åˆ°é£ä¹¦ç¾¤å—ï¼Ÿ
**A**: å¯ä»¥ï¼ä¿®æ”¹ `.env`ï¼š
```bash
# æ”¹ç”¨ chat_id æ›¿ä»£ open_id
FEISHU_RECEIVER_OPEN_ID=oc_ç¾¤èŠid

# ç„¶ååœ¨ notify_feishu.py è°ƒç”¨æ—¶åŠ å‚æ•°ï¼š
# receive_id_type="chat_id"
```

### Q3: é€šçŸ¥èƒ½å¸¦éŸ³é¢‘è¯•å¬å—ï¼Ÿ
**A**: é£ä¹¦å¡ç‰‡ä¸æ”¯æŒç›´æ¥åµŒå…¥éŸ³é¢‘ã€‚å¯ä»¥æ·»åŠ æ–‡ä»¶é“¾æ¥æˆ–ä½¿ç”¨é£ä¹¦äº‘æ–‡æ¡£åˆ†äº«ã€‚

### Q4: å¦‚ä½•è·å–ç¾¤èŠ chat_idï¼Ÿ
**A**:
```bash
# æ–¹æ³•1: è®©æœºå™¨äººåŠ å…¥ç¾¤èŠï¼ŒæŸ¥çœ‹äº‹ä»¶æ—¥å¿—
# æ–¹æ³•2: ä½¿ç”¨ API æŸ¥è¯¢
curl -H "Authorization: Bearer {token}" \
  "https://open.feishu.cn/open-apis/im/v1/chats"
```

---

## æµ‹è¯•å‘½ä»¤

```bash
# å®Œæ•´æµ‹è¯•æµç¨‹ï¼ˆä½¿ç”¨ä»Šå¤©çš„æ’­å®¢ï¼‰
./scripts/run_daily.sh

# æŸ¥çœ‹æ—¥å¿—
cat logs/daily-$(date +%Y-%m-%d).log

# ä»…æµ‹è¯•é£ä¹¦é€šçŸ¥
python scripts/notify_feishu.py --date 2026-01-15 --article-count 10
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: æç¤º "è·³è¿‡é£ä¹¦é€šçŸ¥"
**åŸå› **: ç¯å¢ƒå˜é‡æœªé…ç½®æˆ–å€¼ä¸ºå ä½ç¬¦
**è§£å†³**: æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å¡«å†™äº†å®é™…å€¼

### é—®é¢˜2: è·å– token å¤±è´¥
**åŸå› **: App ID æˆ– App Secret é”™è¯¯
**è§£å†³**: é‡æ–°ä»é£ä¹¦å¼€æ”¾å¹³å°å¤åˆ¶å‡­è¯

### é—®é¢˜3: å‘é€æ¶ˆæ¯å¤±è´¥ (code: 230002)
**åŸå› **: æ²¡æœ‰å‘é€æ¶ˆæ¯æƒé™
**è§£å†³**: é£ä¹¦å¼€æ”¾å¹³å° â†’ æƒé™ç®¡ç† â†’ å¼€é€š `im:message`

### é—®é¢˜4: æ¥æ”¶è€…æ”¶ä¸åˆ°æ¶ˆæ¯
**åŸå› **: Open ID é”™è¯¯æˆ–åº”ç”¨æœªå‘å¸ƒ
**è§£å†³**:
1. ç¡®è®¤åº”ç”¨å·²å‘å¸ƒï¼ˆå‘å¸ƒè®¾ç½® â†’ åˆ›å»ºç‰ˆæœ¬ï¼‰
2. éªŒè¯ Open ID æ˜¯å¦æ­£ç¡®

---

## ä¸‹ä¸€æ­¥æ“ä½œ

1. **ç°åœ¨é…ç½®**ï¼ˆå¦‚æœéœ€è¦é€šçŸ¥ï¼‰:
   ```bash
   # è®¿é—®é£ä¹¦å¼€æ”¾å¹³å°
   open https://open.feishu.cn/app

   # è·å–å‡­è¯åç¼–è¾‘é…ç½®
   code .env

   # æµ‹è¯•é€šçŸ¥
   python scripts/notify_feishu.py --date 2026-01-15 --article-count 10
   ```

2. **æˆ–è€…å…ˆä¸é…ç½®**:
   - æ’­å®¢ç…§å¸¸æ¯å¤© 7 ç‚¹ç”Ÿæˆ
   - ä½ æ‰‹åŠ¨æŸ¥çœ‹ `output/{date}/` ç›®å½•
   - éœ€è¦æ—¶å†é…ç½®é£ä¹¦é€šçŸ¥

---

## å‚è€ƒèµ„æ–™

- **é£ä¹¦å¼€æ”¾å¹³å°**: https://open.feishu.cn/document/
- **å‘é€æ¶ˆæ¯ API**: https://open.feishu.cn/document/server-docs/im-v1/message/create
- **è·å–ç”¨æˆ· ID**: https://open.feishu.cn/document/server-docs/contact-v3/user/batch_get_id
