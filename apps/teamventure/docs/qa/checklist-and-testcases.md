# TeamVenture 一期（小程序）QA Checklist & Test Cases

> 基于：交互设计 `docs/design/teamventure-phase1-miniapp-product-design.md` 与接口契约 `docs/design/teamventure-phase1-api-design.md`

---

## 1) 测试范围

### P0 必测旅程
- 登录：微信 code 换 session
- 生成方案：输入→生成→对比→详情
- 确认方案：draft→confirmed
- 联系供应商：拨号/复制 + 服务端记录
- 我的方案：列表分页→详情

### 非功能
- 生成耗时与超时兜底
- 弱网/断网、服务端 5xx、LLM 错误
- 基础兼容：不同机型/系统版本/微信版本

---

## 2) 测试 Checklist（执行清单）

### 2.1 登录与会话（v1.2 更新）

#### 两步登录流程
- wx.login() 成功获取 code
- 获取 code 失败时显示友好错误提示
- 用户信息表单正确显示（头像选择器 + 昵称输入框）
- 头像选择器正常弹出并返回临时路径
- 昵称输入框支持微信昵称快速填充（type="nickname"）
- 未选择头像时允许提交，前端显示占位符 👤
- 未输入昵称时允许提交，后端使用默认昵称"微信用户"
- 昵称包含前后空格时自动 trim 处理
- 提交登录请求包含 code、nickname、avatarUrl 三个参数
- 后端成功创建或更新用户记录（users 表）
- 后端返回 sessionToken 和完整 userInfo 对象
- 前端正确存储 token 和 userInfo 到本地 storage
- 登录成功后跳转到首页
- 我的页面正确显示用户头像和昵称
- 头像 URL 过期时（48小时后）显示占位符，不崩溃

#### 退出登录
- 退出登录清除所有本地数据（sessionToken、userInfo）
- 退出登录后页面状态正确重置
- 退出登录后再次访问需登录功能跳转到登录页

#### 会话管理
- 未登录访问任何 `/v1/*` 接口返回 `UNAUTHENTICATED`
- session 过期后自动引导重新登录（不死循环）
- token 不落日志（客户端/服务端）
- 重复登录时正确更新用户信息（nickname、avatar）
- 重复登录时不创建重复用户记录

### 2.2 输入校验（生成方案）
- 人数边界：0、1、500、501
- 预算边界：min=0、max<min、极大值（溢出/精度）
- 日期边界：end<start、跨度超限、闰日/跨月
- 城市为空、偏好为空（默认值是否合理）

### 2.3 生成过程（Loading/Timeout）
- <60s 正常返回：展示 3 套方案
- 超时：提示 + 可重试（输入不丢失）
- LLM 异常：提示“稍后重试”，不展示半成品

### 2.4 对比与详情
- 对比页：3 卡片信息一致、排序固定、可进入详情
- 详情页：行程/预算/供应商模块不出现空白块
- 空数据兜底：供应商不足时展示“资源不足”提示

### 2.5 确认方案
- draft 点击确认：状态变更为 confirmed
- 重复确认（幂等）：第二次确认不报错，状态不抖动
- confirmed 在“我的方案”列表状态显示正确

### 2.6 联系供应商
- 拨号：系统能力调用成功/失败提示
- 复制微信：复制成功提示
- 服务端记录：每次联系只记录一次（避免多次点击刷数据，可做节流/去重策略验证）

### 2.7 我的方案
- 列表分页：page/page_size 边界、空列表文案与 CTA
- 详情可复看：状态/内容一致

### 2.8 首页功能（v1.2 新增）

#### Banner 横幅
- Banner 正确显示文案和样式
- "立即体验"按钮跳转到生成方案页

#### 快捷操作网格
- 4个快捷操作正确显示（生成方案、我的方案、收藏、设置）
- 点击"生成方案"跳转到生成方案Tab
- 点击"我的方案"跳转到我的方案Tab
- 点击"收藏"显示"功能开发中"提示
- 点击"设置"显示"功能开发中"提示

#### 热门目的地
- 横向滚动流畅，无卡顿
- 8个热门目的地正确显示（密云、怀柔、延庆、崇明、平谷、门头沟、十渡、古北水镇）
- 每个目的地显示 emoji 图标和名称
- 点击目的地正确预填到生成方案页的目的地字段
- 预填成功后清除本地存储的临时数据

#### 推荐方案
- 推荐方案列表正确显示（3个精选方案）
- 每个方案显示标题、价格、人数、天数、标签
- 方案卡片样式正确
- 点击方案卡片跳转到详情页（如已实现）

#### 活动类型网格
- 6个活动类型正确显示（3列×2行）
- 每个类型显示 emoji 图标和名称
- 网格布局正确，无错位

### 2.9 我的页面（v1.2 新增）

#### 用户信息卡片（已登录状态）
- 用户头像正确显示（圆形，160rpx）
- 头像URL失效时显示占位符 👤
- 用户昵称正确显示
- 昵称为空时显示"未设置昵称"
- 卡片渐变背景正确显示

#### 用户信息卡片（未登录状态）
- 显示占位符 👤
- 显示"未登录"文字
- 显示"点击登录"按钮
- 点击登录按钮跳转到登录页

#### 统计数据卡片
- 已登录状态显示统计数据（总方案、收藏、已完成）
- 统计数据正确（与实际数据一致）
- 统计数据加载失败时显示占位数据"0"，不影响页面展示
- 未登录状态不显示统计卡片

#### 功能菜单
- 已登录状态显示完整菜单（6项）
- 未登录状态仅显示部分菜单（设置、帮助与反馈、关于我们）
- 点击"我的方案"跳转到我的方案Tab（需登录）
- 点击"我的收藏"显示"功能开发中"提示（需登录）
- 点击"浏览历史"显示"功能开发中"提示（需登录）
- 点击"设置"显示"功能开发中"提示（无需登录）
- 点击"帮助与反馈"显示"功能开发中"提示（无需登录）
- 点击"关于我们"显示关于弹窗，包含版本号（无需登录）
- 未登录访问需登录功能时显示"请先登录"提示，提供"去登录"按钮

#### 退出登录按钮
- 已登录状态显示"退出登录"按钮
- 未登录状态不显示退出按钮
- 点击退出登录弹出确认弹窗
- 确认退出后清除本地数据
- 页面状态正确重置为未登录状态
- 显示"已退出登录"成功提示

#### 页面生命周期
- onShow 时重新检查登录状态
- 登录后返回页面时自动更新用户信息
- 退出登录后页面状态正确更新

---

## 3) Test Cases（示例用例表）

> 说明：这里只列核心用例样例；实际执行可按模块扩展到更细粒度。

| ID | 模块 | 用例标题 | 前置条件 | 步骤 | 期望结果 |
|---|---|---|---|---|---|
| TC-LOGIN-001 | 登录 | 微信登录成功 | 小程序可联网 | 触发登录 → 调用 `/v1/auth/wechat/login` | 返回 `session_token`，后续接口鉴权通过 |
| TC-PLAN-001 | 生成 | 合法输入生成成功 | 已登录 | 填写人数/预算/日期/城市/偏好 → 生成 | 60s 内进入对比页，展示 3 套方案 |
| TC-PLAN-002 | 生成 | budget_max < budget_min | 已登录 | 输入 min=50000 max=35000 → 生成 | 前端就地提示或接口返回 `INVALID_ARGUMENT` |
| TC-PLAN-003 | 生成 | 生成超时兜底 | 已登录 | 模拟后端超时 | 展示超时提示 + 可重试，输入不丢 |
| TC-PLAN-010 | 对比 | 从对比进入详情 | 已生成方案 | 对比页点击某方案“查看详情” | 进入详情页，展示行程/预算/供应商 |
| TC-PLAN-020 | 确认 | draft → confirmed | 已生成 draft 方案 | 点击“确认此方案” | 状态变更为 confirmed；列表展示正确 |
| TC-CONTACT-001 | 联系 | 拨号联系供应商 | 详情页有联系方式 | 点击拨号按钮 | 调起拨号；服务端产生一条联系记录 |
| TC-LIST-001 | 列表 | 我的方案列表分页 | 已有 11 条方案 | 打开“我的方案”加载第1页 | 展示 10 条；翻页展示第2页 1条 |
| TC-SEC-001 | 安全 | 未登录请求保护接口 | 未登录/过期 | 调用 `/v1/plans` | 返回 `UNAUTHENTICATED` |

