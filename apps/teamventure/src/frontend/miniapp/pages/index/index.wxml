<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">AI 生成团建方案</view>
    <view class="page-subtitle">请详细描述您的团建行程需求</view>
  </view>

  <!-- Markdown 输入区域 -->
  <view class="form-container">
    <!-- 填写提示和操作 -->
    <view class="template-header">
      <view class="template-hint">
        <text class="hint-icon">✏️</text>
        <text class="hint-text">直接修改示例内容为您的实际需求</text>
      </view>
      <view class="template-actions">
        <view class="action-btn ai-fill-btn {{aiGenerateStatus === 'generating' ? 'btn-disabled' : ''}}" bindtap="handleShowAIFillDialog">
          <text class="btn-icon">✨</text>
          <text class="btn-text">AI填充</text>
        </view>
        <view class="action-btn reset-btn {{aiGenerateStatus === 'generating' ? 'btn-disabled' : ''}}" bindtap="handleShowTemplate">
          <text class="btn-icon">🔄</text>
          <text class="btn-text">重置</text>
        </view>
      </view>
    </view>

    <!-- Markdown 输入框 / AI生成状态卡片 -->
    <view class="form-item">
      <!-- 正常编辑状态 -->
      <block wx:if="{{aiGenerateStatus === 'normal' || aiGenerateStatus === 'generated'}}">
        <textarea
          class="markdown-input"
          placeholder="{{placeholder}}"
          value="{{formData.markdownContent}}"
          bindinput="handleMarkdownInput"
          maxlength="5000"
          auto-height
          disabled="{{aiGenerateStatus === 'generating'}}"
        />
        <view class="textarea-count">{{formData.markdownContent.length}}/5000</view>
      </block>

      <!-- AI生成中状态 -->
      <block wx:if="{{aiGenerateStatus === 'generating'}}">
        <view class="ai-generating-card">
          <view class="generating-header">
            <view class="generating-title">
              <text class="generating-icon loading-spin">⚡</text>
              <text class="generating-text">AI 生成中</text>
              <view class="refresh-icon-wrapper">
                <text class="refresh-icon loading-spin">🔄</text>
              </view>
            </view>
            <view class="generating-progress">
              <view class="progress-bar">
                <view class="progress-fill" style="width: {{generateProgress}}%;"></view>
              </view>
              <text class="progress-text">{{generateProgress}}%</text>
            </view>
          </view>
          <view class="generating-tips">
            <text>正在为您生成个性化团建方案</text>
          </view>
        </view>
      </block>
    </view>

    <!-- 生成说明 -->
    <view class="generate-tips">
      <view class="tip-item">
        <text class="tip-icon">💡</text>
        <text class="tip-text">点击「生成方案」后，AI将根据您的描述生成定制化方案</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">⏱️</text>
        <text class="tip-text">生成时间约1-2分钟，请耐心等待</text>
      </view>
    </view>

    <!-- 生成方案按钮 -->
    <view class="form-actions">
      <button class="btn-generate" bindtap="handleGenerate" disabled="{{aiGenerateStatus === 'generating'}}">
        <text class="btn-icon">✨</text>
        <text>AI 生成方案</text>
      </button>
    </view>
  </view>

  <!-- AI填充弹窗 -->
  <view class="ai-fill-modal" wx:if="{{showAIFillDialog}}" catchtap="handleCloseAIFillDialog">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">AI 智能填充</view>
        <view class="modal-close" bindtap="handleCloseAIFillDialog">×</view>
      </view>

      <view class="modal-body">
        <view class="modal-hint">只需填写3个核心信息，AI将为您生成完整模板</view>

        <!-- 天数输入 -->
        <view class="fill-form-item">
          <view class="fill-label">
            <text class="label-text">天数（1-9天）</text>
            <text class="label-required">*</text>
          </view>
          <input
            class="fill-input"
            type="digit"
            placeholder="如：3"
            value="{{aiFillData.days}}"
            bindinput="handleDaysInput"
          />
        </view>

        <!-- 出发地 -->
        <view class="fill-form-item">
          <view class="fill-label">
            <text class="label-text">出发地</text>
            <text class="label-required">*</text>
          </view>
          <input
            class="fill-input"
            placeholder="如：北京"
            value="{{aiFillData.origin}}"
            bindinput="handleOriginInput"
          />
        </view>

        <!-- 到达地 -->
        <view class="fill-form-item">
          <view class="fill-label">
            <text class="label-text">到达地</text>
            <text class="label-required">*</text>
          </view>
          <input
            class="fill-input"
            placeholder="如：青岛"
            value="{{aiFillData.destination}}"
            bindinput="handleDestinationInput"
          />
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="handleCloseAIFillDialog">取消</button>
        <button class="modal-btn confirm-btn" bindtap="handleConfirmAIFill">确认填充</button>
      </view>
    </view>
  </view>
</view>
