<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
  <view class="steps">
    <view class="step-item {{currentStep >= 1 ? 'active' : ''}} {{currentStep > 1 ? 'completed' : ''}}">
      <view class="step-number">1</view>
      <view class="step-label">åŸºç¡€ä¿¡æ¯</view>
    </view>
    <view class="step-line {{currentStep > 1 ? 'active' : ''}}"></view>
    <view class="step-item {{currentStep >= 2 ? 'active' : ''}}">
      <view class="step-number">2</view>
      <view class="step-label">åå¥½é€‰æ‹©</view>
    </view>
  </view>

  <!-- Step 1: åŸºç¡€ä¿¡æ¯ -->
  <view class="form-container" wx:if="{{currentStep === 1}}">
    <view class="form-title">å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„å›¢å»ºéœ€æ±‚</view>

    <!-- å‚ä¸äººæ•° -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">å‚ä¸äººæ•°</text>
        <text class="required">*</text>
      </view>
      <view class="input-group">
        <stepper
          value="{{formData.peopleCount}}"
          min="1"
          max="500"
          bindchange="handlePeopleCountChange"
        ></stepper>
        <text class="unit">äºº</text>
      </view>
      <!-- å¿«æ·æŒ‰é’® -->
      <view class="quick-buttons">
        <view
          class="quick-btn {{formData.peopleCount === 20 ? 'active' : ''}}"
          bindtap="handleQuickPeople"
          data-value="20"
        >20äºº</view>
        <view
          class="quick-btn {{formData.peopleCount === 50 ? 'active' : ''}}"
          bindtap="handleQuickPeople"
          data-value="50"
        >50äºº</view>
        <view
          class="quick-btn {{formData.peopleCount === 100 ? 'active' : ''}}"
          bindtap="handleQuickPeople"
          data-value="100"
        >100äºº</view>
      </view>
    </view>

    <!-- é¢„ç®—èŒƒå›´ -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">é¢„ç®—èŒƒå›´</text>
        <text class="required">*</text>
      </view>
      <view class="budget-input-group">
        <view class="budget-input-item">
          <text class="currency">Â¥</text>
          <input
            class="budget-input"
            type="digit"
            placeholder="æœ€ä½é¢„ç®—"
            value="{{formData.budgetMin}}"
            bindinput="handleBudgetMinInput"
          />
        </view>
        <text class="separator">-</text>
        <view class="budget-input-item">
          <text class="currency">Â¥</text>
          <input
            class="budget-input"
            type="digit"
            placeholder="æœ€é«˜é¢„ç®—"
            value="{{formData.budgetMax}}"
            bindinput="handleBudgetMaxInput"
          />
        </view>
      </view>
      <view class="budget-hint" wx:if="{{budgetPerPerson}}">
        äººå‡é¢„ç®—ï¼š{{budgetPerPerson}}
      </view>
      <view class="budget-warning" wx:if="{{budgetWarning}}">
        {{budgetWarning}}
      </view>
    </view>

    <!-- æ´»åŠ¨æ—¥æœŸ -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">æ´»åŠ¨æ—¥æœŸ</text>
        <text class="required">*</text>
      </view>
      <view class="date-input-group">
        <picker
          mode="date"
          value="{{formData.startDate}}"
          start="{{minDate}}"
          bindchange="handleStartDateChange"
        >
          <view class="date-picker">
            <text wx:if="{{formData.startDate}}">{{formData.startDate}}</text>
            <text wx:else class="placeholder">å¼€å§‹æ—¥æœŸ</text>
          </view>
        </picker>
        <text class="separator">è‡³</text>
        <picker
          mode="date"
          value="{{formData.endDate}}"
          start="{{formData.startDate || minDate}}"
          bindchange="handleEndDateChange"
        >
          <view class="date-picker">
            <text wx:if="{{formData.endDate}}">{{formData.endDate}}</text>
            <text wx:else class="placeholder">ç»“æŸæ—¥æœŸ</text>
          </view>
        </picker>
      </view>
      <view class="date-hint" wx:if="{{durationDays}}">
        {{durationDays}}
      </view>
    </view>

    <!-- è¡Œç¨‹ç±»å‹ -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">è¡Œç¨‹ç±»å‹</text>
        <text class="required">*</text>
      </view>
      <view class="trip-type-group">
        <view
          wx:for="{{tripTypes}}"
          wx:key="value"
          class="trip-type-item {{formData.tripType === item.value ? 'selected' : ''}}"
          bindtap="handleTripTypeChange"
          data-value="{{item.value}}"
        >
          <view class="trip-type-icon">{{item.icon}}</view>
          <view class="trip-type-label">{{item.label}}</view>
          <view class="trip-type-desc">{{item.description}}</view>
        </view>
      </view>
    </view>

    <!-- å‘¨è¾¹æ¸¸ï¼šçœ-å¸‚-åŒºä¸‰çº§è”åŠ¨ -->
    <view wx:if="{{formData.tripType === 'regional'}}">
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">å‡ºå‘åŸå¸‚</text>
          <text class="required">*</text>
        </view>
        <input
          class="text-input"
          placeholder="è¯·è¾“å…¥å‡ºå‘åŸå¸‚"
          value="{{formData.location.regional.departureCity}}"
          bindinput="handleRegionalDepartureCityInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç›®çš„åœ°çœä»½</text>
          <text class="required">*</text>
        </view>
        <picker
          mode="selector"
          range="{{provinceList}}"
          range-key="name"
          value="{{selectedProvinceIndex}}"
          bindchange="handleProvinceChange"
        >
          <view class="picker-display">
            <text wx:if="{{formData.location.regional.destinationProvince}}">
              {{formData.location.regional.destinationProvince}}
            </text>
            <text wx:else class="placeholder">è¯·é€‰æ‹©çœä»½</text>
          </view>
        </picker>
      </view>

      <view class="form-item" wx:if="{{cityList.length > 0}}">
        <view class="form-label">
          <text class="label-text">ç›®çš„åœ°åŸå¸‚</text>
          <text class="required">*</text>
        </view>
        <picker
          mode="selector"
          range="{{cityList}}"
          range-key="name"
          value="{{selectedCityIndex}}"
          bindchange="handleCityChange"
        >
          <view class="picker-display">
            <text wx:if="{{formData.location.regional.destinationCity}}">
              {{formData.location.regional.destinationCity}}
            </text>
            <text wx:else class="placeholder">è¯·é€‰æ‹©åŸå¸‚</text>
          </view>
        </picker>
      </view>

      <view class="form-item" wx:if="{{districtList.length > 0}}">
        <view class="form-label">
          <text class="label-text">ç›®çš„åœ°åŒºå¿/æ™¯ç‚¹</text>
          <text class="hint-text">ï¼ˆå¯é€‰ï¼‰</text>
        </view>
        <picker
          mode="selector"
          range="{{districtList}}"
          range-key="name"
          value="{{selectedDistrictIndex}}"
          bindchange="handleDistrictChange"
        >
          <view class="picker-display">
            <text wx:if="{{formData.location.regional.destinationLocation}}">
              {{formData.location.regional.destinationLocation}}
            </text>
            <text wx:else class="placeholder">è¯·é€‰æ‹©åŒºå¿/æ™¯ç‚¹</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- å›½å†…æ¸¸ï¼šå‡ºå‘åŸå¸‚+ç›®çš„åœ°åŸå¸‚ -->
    <view wx:if="{{formData.tripType === 'domestic'}}">
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">å‡ºå‘åŸå¸‚</text>
          <text class="required">*</text>
        </view>
        <input
          class="text-input"
          placeholder="è¯·è¾“å…¥å‡ºå‘åŸå¸‚"
          value="{{formData.location.domestic.departureCity}}"
          bindinput="handleDomesticDepartureCityInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç›®çš„åœ°åŸå¸‚</text>
          <text class="required">*</text>
        </view>
        <input
          class="text-input"
          placeholder="è¯·è¾“å…¥ç›®çš„åœ°åŸå¸‚"
          value="{{formData.location.domestic.destinationCity}}"
          bindinput="handleDomesticDestinationCityInput"
        />
      </view>
    </view>

    <!-- å‡ºå¢ƒæ¸¸ï¼šå‡ºå‘åŸå¸‚+å›½å®¶/åŸå¸‚ -->
    <view wx:if="{{formData.tripType === 'international'}}">
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">å‡ºå‘åŸå¸‚</text>
          <text class="required">*</text>
        </view>
        <input
          class="text-input"
          placeholder="è¯·è¾“å…¥å‡ºå‘åŸå¸‚"
          value="{{formData.location.international.departureCity}}"
          bindinput="handleInternationalDepartureCityInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç›®çš„åœ°å›½å®¶</text>
          <text class="required">*</text>
        </view>
        <input
          class="text-input"
          placeholder="ä¾‹å¦‚ï¼šæ—¥æœ¬ã€æ³°å›½"
          value="{{formData.location.international.destinationCountry}}"
          bindinput="handleInternationalDestinationCountryInput"
        />
      </view>

      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç›®çš„åœ°åŸå¸‚</text>
          <text class="hint-text">ï¼ˆå¯é€‰ï¼‰</text>
        </view>
        <input
          class="text-input"
          placeholder="ä¾‹å¦‚ï¼šä¸œäº¬ã€æ›¼è°·"
          value="{{formData.location.international.destinationCity}}"
          bindinput="handleInternationalDestinationCityInput"
        />
      </view>
    </view>

    <!-- è‡ªå®šä¹‰ï¼šè‡ªç”±æè¿° -->
    <view wx:if="{{formData.tripType === 'custom'}}">
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">è¡Œç¨‹æè¿°</text>
          <text class="required">*</text>
        </view>
        <textarea
          class="textarea-input"
          placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„è¡Œç¨‹éœ€æ±‚ï¼ŒåŒ…æ‹¬å‡ºå‘åœ°ã€ç›®çš„åœ°ã€æœŸæœ›çš„æ´»åŠ¨å†…å®¹ç­‰ï¼ˆæ”¯æŒMarkdownæ ¼å¼ï¼‰"
          value="{{formData.location.custom.description}}"
          bindinput="handleCustomDescriptionInput"
          maxlength="1024"
        />
        <view class="textarea-count">{{formData.location.custom.description.length}}/1024</view>
      </view>
    </view>

    <!-- ä¸‹ä¸€æ­¥æŒ‰é’® -->
    <view class="form-actions">
      <button class="btn-next" bindtap="handleNextStep">ä¸‹ä¸€æ­¥</button>
    </view>
  </view>

  <!-- Step 2: åå¥½é€‰æ‹© -->
  <view class="form-container" wx:if="{{currentStep === 2}}">
    <view class="form-title">é€‰æ‹©æ‚¨çš„åå¥½</view>

    <!-- æ´»åŠ¨ç±»å‹ -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">æ´»åŠ¨ç±»å‹</text>
        <text class="hint-text">ï¼ˆå¯å¤šé€‰ï¼‰</text>
      </view>
      <view class="chips-group">
        <view
          wx:for="{{activityTypes}}"
          wx:key="value"
          class="chip {{formData.preferences.activityTypes.includes(item.value) ? 'selected' : ''}}"
          bindtap="handleActivityTypeToggle"
          data-value="{{item.value}}"
        >
          {{item.label}}
        </view>
      </view>
    </view>

    <!-- ä½å®¿æ ‡å‡† -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">ä½å®¿æ ‡å‡†</text>
      </view>
      <view class="radio-group">
        <view
          wx:for="{{accommodationLevels}}"
          wx:key="value"
          class="radio-item {{formData.preferences.accommodationLevel === item.value ? 'selected' : ''}}"
          bindtap="handleAccommodationLevelChange"
          data-value="{{item.value}}"
        >
          <view class="radio-circle">
            <view class="radio-dot" wx:if="{{formData.preferences.accommodationLevel === item.value}}"></view>
          </view>
          <text>{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- ç‰¹æ®Šéœ€æ±‚ -->
    <view class="form-item">
      <view class="form-label">
        <text class="label-text">ç‰¹æ®Šéœ€æ±‚</text>
        <text class="hint-text">ï¼ˆé€‰å¡«ï¼‰</text>
      </view>
      <textarea
        class="textarea-input"
        placeholder="è¯·è¾“å…¥ç‰¹æ®Šéœ€æ±‚ï¼Œå¦‚ï¼šæœ‰è€äººæˆ–å°å­©ã€èº«ä½“é™åˆ¶ç­‰"
        value="{{formData.preferences.specialRequirements}}"
        bindinput="handleSpecialRequirementsInput"
        maxlength="200"
      />
      <view class="textarea-count">{{formData.preferences.specialRequirements.length}}/200</view>
    </view>

    <!-- ç”Ÿæˆè¯´æ˜ -->
    <view class="generate-tips">
      <view class="tip-item">
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">ç‚¹å‡»ã€Œç”Ÿæˆæ–¹æ¡ˆã€åï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆ3å¥—æ–¹æ¡ˆä¾›å¯¹æ¯”</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">â±ï¸</text>
        <text class="tip-text">ç”Ÿæˆæ—¶é—´çº¦15-30ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…</text>
      </view>
    </view>

    <!-- æŒ‰é’®ç»„ -->
    <view class="form-actions form-actions-double">
      <button class="btn-back" bindtap="handleBackStep">ä¸Šä¸€æ­¥</button>
      <button class="btn-generate" bindtap="handleGenerate">
        <text class="btn-icon">âœ¨</text>
        <text>AI ç”Ÿæˆæ–¹æ¡ˆ</text>
      </button>
    </view>
  </view>
</view>
