# 行程类型选择器测试清单

## 测试环境准备
1. 使用微信开发者工具打开项目
2. 确保后端服务已启动（Java: 8080, Python: 8000）
3. 打开调试控制台查看console.log输出

## Phase 1: 数据结构与映射测试

### 测试用例 1.1 - 初始化检查
- [ ] 打开首页，检查控制台是否输出 `📍 [Initial FormData]`
- [ ] 验证 `tripType` 默认值为空字符串
- [ ] 验证 `location` 对象包含4个子对象（regional, domestic, international, custom）

### 测试用例 1.2 - 行程类型切换
- [ ] 依次点击4种行程类型（周边游、国内游、出境游、自定义）
- [ ] 每次点击后检查UI是否正确切换到对应的输入区域
- [ ] 验证选中状态样式是否正确（蓝色边框、浅蓝背景）

## Phase 2: 周边游三级联动

### 测试用例 2.1 - 省份选择
- [ ] 选择"周边游"
- [ ] 点击"目的地省份"选择器
- [ ] 验证是否显示8个省份（浙江、江苏、广东、云南、四川、海南、安徽、福建）
- [ ] 选择"浙江省"
- [ ] 检查控制台输出 `📍 [Province Change]`

### 测试用例 2.2 - 城市联动
- [ ] 省份选择后，"目的地城市"选择器应自动显示
- [ ] 点击"目的地城市"选择器
- [ ] 验证城市列表是否正确（浙江省应显示：杭州市、宁波市、湖州市）
- [ ] 选择"杭州市"
- [ ] 检查控制台输出 `📍 [City Change]`

### 测试用例 2.3 - 区县联动
- [ ] 城市选择后，"目的地区县/景点"选择器应自动显示
- [ ] 点击选择器
- [ ] 验证区县列表是否正确（杭州市应显示：西湖区、西溪湿地、千岛湖、桐庐县）
- [ ] 选择"千岛湖"
- [ ] 检查控制台输出 `📍 [District Change]`

### 测试用例 2.4 - 出发城市输入
- [ ] 在"出发城市"输入框输入"上海市"
- [ ] 验证输入是否正确保存到 `formData.location.regional.departureCity`

## Phase 3: 国内游测试

### 测试用例 3.1 - 切换到国内游
- [ ] 点击"国内游"行程类型
- [ ] 验证周边游的三级选择器消失
- [ ] 验证显示两个文本输入框（出发城市、目的地城市）

### 测试用例 3.2 - 输入验证
- [ ] 在"出发城市"输入"北京市"
- [ ] 在"目的地城市"输入"成都市"
- [ ] 验证输入保存到 `formData.location.domestic`

## Phase 4: 出境游测试

### 测试用例 4.1 - 切换到出境游
- [ ] 点击"出境游"行程类型
- [ ] 验证显示三个输入框（出发城市、目的地国家、目的地城市）

### 测试用例 4.2 - 输入验证
- [ ] 在"出发城市"输入"上海市"
- [ ] 在"目的地国家"输入"日本"
- [ ] 在"目的地城市"输入"东京"（可选）
- [ ] 验证输入保存到 `formData.location.international`

## Phase 5: 自定义类型测试

### 测试用例 5.1 - 切换到自定义
- [ ] 点击"自定义"行程类型
- [ ] 验证显示大型文本域（支持Markdown）

### 测试用例 5.2 - 文本输入
- [ ] 输入详细的行程描述（包含出发地、目的地、期望活动）
- [ ] 验证字符计数显示正确（x/1024）
- [ ] 验证输入保存到 `formData.location.custom.description`

## Phase 6: 表单验证测试

### 测试用例 6.1 - 周边游必填项验证
- [ ] 选择"周边游"但不填写任何字段
- [ ] 点击"下一步"
- [ ] 验证显示"请输入出发城市"提示
- [ ] 填写出发城市，点击"下一步"
- [ ] 验证显示"请选择目的地省份"提示
- [ ] 选择省份，点击"下一步"
- [ ] 验证显示"请选择目的地城市"提示
- [ ] 选择城市，点击"下一步"
- [ ] 验证成功进入第二步

### 测试用例 6.2 - 国内游必填项验证
- [ ] 选择"国内游"但不填写城市
- [ ] 点击"下一步"
- [ ] 验证显示"请输入出发城市"提示
- [ ] 填写出发城市，点击"下一步"
- [ ] 验证显示"请输入目的地城市"提示

### 测试用例 6.3 - 出境游必填项验证
- [ ] 选择"出境游"但不填写字段
- [ ] 验证显示"请输入出发城市"提示
- [ ] 填写出发城市，点击"下一步"
- [ ] 验证显示"请输入目的地国家"提示

### 测试用例 6.4 - 自定义描述验证
- [ ] 选择"自定义"但不填写描述
- [ ] 点击"下一步"
- [ ] 验证显示"请输入行程描述"提示
- [ ] 输入少于10个字符
- [ ] 点击"下一步"
- [ ] 验证显示"行程描述至少需要10个字符"提示

## Phase 7: 数据映射验证

### 测试用例 7.1 - 周边游映射
- [ ] 完整填写周边游表单（含第二步偏好设置）
- [ ] 点击"AI 生成方案"
- [ ] 检查控制台输出 `📍 [Before Mapping]`
- [ ] 检查控制台输出 `📍 [Mapping Input]` - 验证tripType和location结构
- [ ] 检查控制台输出 `📍 [Mapping Output]` - 验证departure_city和destination映射正确
- [ ] 检查控制台输出 `📍 [After Mapping]`
- [ ] 验证API请求包含正确的 `departure_city` 和 `destination` 字段

### 测试用例 7.2 - 国内游映射
- [ ] 重复测试用例7.1，使用国内游类型
- [ ] 验证 `destination` 仅包含目的地城市名称

### 测试用例 7.3 - 出境游映射
- [ ] 重复测试用例7.1，使用出境游类型
- [ ] 验证 `destination` 格式为 "国家 城市"（如："日本 东京"）
- [ ] 如果未填写城市，验证 `destination` 仅包含国家名

### 测试用例 7.4 - 自定义映射
- [ ] 重复测试用例7.1，使用自定义类型
- [ ] 验证 `destination` 包含完整的描述文本
- [ ] 验证 `departure_city` 可能为空（自定义类型不强制要求）

## 边界条件测试

### 测试用例 8.1 - 快速切换
- [ ] 选择"周边游"并填写完整信息
- [ ] 切换到"国内游"
- [ ] 验证之前填写的周边游数据仍保留在 `location.regional`
- [ ] 验证国内游输入框为空

### 测试用例 8.2 - 数据持久化
- [ ] 填写完整表单
- [ ] 关闭小程序
- [ ] 重新打开
- [ ] 验证表单数据是否自动恢复（通过 `loadLastRequest()`）

### 测试用例 8.3 - 网络错误处理
- [ ] 停止后端服务
- [ ] 填写完整表单并点击"AI 生成方案"
- [ ] 验证显示友好的错误提示（不是原始错误信息）

## 回归测试

### 测试用例 9.1 - 原有功能不受影响
- [ ] 参与人数快捷按钮（20/50/100人）功能正常
- [ ] 预算范围计算人均预算正常
- [ ] 日期选择器计算天数正常
- [ ] 活动类型多选功能正常
- [ ] 住宿标准单选功能正常
- [ ] 特殊需求输入功能正常

### 测试用例 9.2 - 第二步功能
- [ ] 完成第一步后可正常进入第二步
- [ ] 第二步可以点击"上一步"返回
- [ ] 返回后数据仍保留

## 性能测试

### 测试用例 10.1 - 选择器性能
- [ ] 快速连续切换省份
- [ ] 验证UI响应流畅，无卡顿
- [ ] 验证城市/区县列表更新及时

### 测试用例 10.2 - 内存检查
- [ ] 在微信开发者工具中查看内存占用
- [ ] 多次切换行程类型
- [ ] 验证无内存泄漏

## 已知限制

1. **cities.js 数据范围**: 仅包含8个省份的主要旅游城市，非完整行政区划数据
2. **自定义类型**: departure_city字段可能为空，后端需兼容
3. **级联选择**: 区县/景点为可选项，API需处理destinationLocation为空的情况

## 调试技巧

### Console日志位置
1. `📍 [Initial FormData]` - 页面onLoad时
2. `📍 [Province Change]` - 选择省份时
3. `📍 [City Change]` - 选择城市时
4. `📍 [District Change]` - 选择区县时
5. `📍 [Before Mapping]` - 生成方案前
6. `📍 [Mapping Input]` - 映射函数输入
7. `📍 [Mapping Output]` - 映射函数输出
8. `📍 [After Mapping]` - 映射后

### 数据检查点
- `formData.tripType` - 当前选择的行程类型
- `formData.location.regional.*` - 周边游数据
- `formData.location.domestic.*` - 国内游数据
- `formData.location.international.*` - 出境游数据
- `formData.location.custom.description` - 自定义描述
- `formData.departureLocation` - 映射后的出发城市（API字段）
- `formData.destination` - 映射后的目的地（API字段）
