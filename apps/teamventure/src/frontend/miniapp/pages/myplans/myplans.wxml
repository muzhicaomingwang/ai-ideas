<!--pages/myplans/myplans.wxml-->
<view class="myplans-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-icon">â³</view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && plans.length === 0}}">
    <view class="empty-icon">ğŸ“­</view>
    <view class="empty-text">è¿˜æ²¡æœ‰æ–¹æ¡ˆ</view>
    <view class="empty-hint">å¿«å»ç”Ÿæˆä¸€ä¸ªå›¢å»ºæ–¹æ¡ˆå§</view>
    <button class="btn-create" bindtap="handleGoCreate">
      å»ç”Ÿæˆæ–¹æ¡ˆ
    </button>
  </view>

  <!-- æ–¹æ¡ˆåˆ—è¡¨ -->
  <view class="plans-list" wx:if="{{!loading && plans.length > 0}}">
    <view
      wx:for="{{plans}}"
      wx:key="plan_id"
      class="plan-card"
      bindtap="handleViewPlan"
      data-plan-id="{{item.plan_id}}"
      bindtouchstart="handleTouchStart"
      bindtouchmove="handleTouchMove"
      bindtouchend="handleTouchEnd"
      data-index="{{index}}"
      style="transform: translateX({{item.translateX || 0}}rpx)"
    >
      <!-- å¡ç‰‡å†…å®¹ -->
      <view class="card-content">
        <!-- å¤´éƒ¨ -->
        <view class="card-header">
          <view class="plan-title">
            <text class="plan-name">{{item.plan_name}}</text>
          </view>
          <view class="status-badge status-{{item.status}}">
            {{item.status_label}}
          </view>
        </view>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <view class="plan-stats">
          <view class="stat-item">
            <text class="stat-icon">ğŸ’°</text>
            <text class="stat-text">Â¥{{item.budget_total}}</text>
          </view>
          <view class="stat-divider">|</view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ‘¥</text>
            <text class="stat-text">{{item.people_count}}äºº</text>
          </view>
          <view class="stat-divider">|</view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ“…</text>
            <text class="stat-text">{{item.duration}}</text>
          </view>
        </view>

        <!-- æ—¥æœŸ -->
        <view class="plan-date" wx:if="{{item.start_date && item.end_date}}">
          {{item.start_date}} è‡³ {{item.end_date}}
        </view>

        <!-- æ—¶é—´æˆ³ -->
        <view class="plan-time">
          {{item.relative_time}}
        </view>
      </view>

      <!-- åˆ é™¤æŒ‰é’®ï¼ˆå·¦æ»‘æ˜¾ç¤ºï¼‰ -->
      <view class="delete-btn" catchtap="handleDelete" data-plan-id="{{item.plan_id}}" data-index="{{index}}">
        åˆ é™¤
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <view class="load-more-text" wx:if="{{!loadingMore}}">
        ä¸Šæ‹‰åŠ è½½æ›´å¤š
      </view>
      <view class="load-more-loading" wx:if="{{loadingMore}}">
        <view class="loading-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
        <text>åŠ è½½ä¸­...</text>
      </view>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && plans.length > 0}}">
      æ²¡æœ‰æ›´å¤šäº†
    </view>
  </view>
</view>
