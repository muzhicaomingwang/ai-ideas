<!--
  day-card ç»„ä»¶ - å•æ—¥è¡Œç¨‹å¡ç‰‡
  Props:
    - dayData: { day, date, items[] }
    - dayIndex: number
    - canDelete: boolean
    - isDragging: boolean
    - draggingItemIndex: number
  Events:
    - datechange, deleteday, addactivity, editactivity, deleteactivity, copyactivity, moveactivity
-->
<view class="day-card">
  <!-- å¤©æ•°å¤´éƒ¨ -->
  <view class="day-header">
    <view class="day-info">
      <view class="day-number">ç¬¬{{dayData.day}}å¤©</view>
      <picker mode="date" value="{{dayData.date}}" bindchange="onDateChange">
        <view class="day-date">
          <text>{{dayData.date || 'é€‰æ‹©æ—¥æœŸ'}}</text>
          <text class="icon-calendar">ğŸ“…</text>
        </view>
      </picker>
    </view>
    <view class="day-actions">
      <view class="action-btn danger"
            bindtap="onDeleteDay"
            wx:if="{{canDelete}}">
        <text class="icon">ğŸ—‘</text>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="activities-list">
    <!-- ç©ºæ´»åŠ¨æç¤º -->
    <view class="empty-activities" wx:if="{{dayData.items.length === 0}}">
      <text class="hint">æš‚æ— æ´»åŠ¨å®‰æ’ï¼Œç‚¹å‡»ä¸‹æ–¹æ·»åŠ </text>
    </view>

    <!-- æ´»åŠ¨é¡¹ -->
    <view class="activity-item-wrapper {{isDragging && draggingItemIndex === index ? 'dragging' : ''}}"
          wx:for="{{dayData.items}}"
          wx:key="id"
          wx:for-index="index">
      <view class="activity-content"
            bindtap="onEditActivity"
            data-item-index="{{index}}">
        <!-- æ—¶é—´ -->
        <view class="activity-time">
          <text class="time-text">{{item.time_start || '--:--'}}</text>
          <text class="time-separator">-</text>
          <text class="time-text">{{item.time_end || '--:--'}}</text>
        </view>
        <!-- è¯¦æƒ… -->
        <view class="activity-details">
          <view class="activity-name">{{item.activity || 'æœªå‘½åæ´»åŠ¨'}}</view>
          <view class="activity-location" wx:if="{{item.location}}">
            <text class="icon-location">ğŸ“</text>
            <text>{{item.location}}</text>
          </view>
          <view class="activity-note" wx:if="{{item.note}}">
            <text class="note-text">{{item.note}}</text>
          </view>
        </view>
      </view>

      <!-- æ´»åŠ¨æ“ä½œæŒ‰é’® -->
      <view class="activity-actions">
        <view class="action-btn small"
              bindtap="onMoveActivity"
              data-item-index="{{index}}"
              data-direction="up"
              wx:if="{{index > 0}}">
          <text class="icon">â†‘</text>
        </view>
        <view class="action-btn small"
              bindtap="onMoveActivity"
              data-item-index="{{index}}"
              data-direction="down"
              wx:if="{{index < dayData.items.length - 1}}">
          <text class="icon">â†“</text>
        </view>
        <view class="action-btn small"
              bindtap="onCopyActivity"
              data-item-index="{{index}}">
          <text class="icon">ğŸ“‹</text>
        </view>
        <view class="action-btn small danger"
              bindtap="onDeleteActivity"
              data-item-index="{{index}}">
          <text class="icon">âœ•</text>
        </view>
      </view>
    </view>

    <!-- æ·»åŠ æ´»åŠ¨æŒ‰é’® -->
    <view class="add-activity-btn" bindtap="onAddActivity">
      <text class="icon">+</text>
      <text>æ·»åŠ æ´»åŠ¨</text>
    </view>
  </view>
</view>
