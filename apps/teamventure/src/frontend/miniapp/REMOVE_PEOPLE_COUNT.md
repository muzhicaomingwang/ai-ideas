# 移除人数字段 - 优化说明

## 🎯 优化目标

人数应该是**动态统计**的字段（多少人参加就是多少人），不需要在生成方案时预填。

## ✅ 已完成修改

### 1. 默认模板（MARKDOWN_TEMPLATE）
**旧版本**：
```markdown
## 基本信息
- **天数**: 3天2夜
- **人数**: 30人          ← 删除
- **预算**: ¥500 - ¥800/人
```

**新版本**：
```markdown
## 基本信息
- **天数**: 3天2夜
- **预算**: ¥500 - ¥800/人
```

### 2. AI生成模板（generateAITemplate函数）
移除了人数字段的生成逻辑：
```javascript
const basicInfo = `# 团建行程方案

## 基本信息
- **天数**: ${days}天${days > 1 ? (days - 1) + '夜' : ''}
- **预算**: ¥500 - ¥800/人  ← 人数行已删除

## 行程路线
- **出发地**: ${origin}
- **到达地**: ${destination}`
```

### 3. 我的方案页（myplans.wxml）
**人数显示逻辑**：
```xml
<!-- 已生成方案 -->
<view class="stat-item" wx:if="{{item.people_count}}">
  <text class="stat-icon">👥</text>
  <text class="stat-text">{{item.people_count}}人</text>
</view>
<!-- people_count为null时不显示 ✅ -->

<!-- 生成中方案 -->
<view class="stat-item" wx:if="{{item.people_count}}">
  <text class="stat-icon">👥</text>
  <text class="stat-text">{{item.people_count}}人</text>
</view>
<!-- people_count为null时不显示 ✅ -->
```

## 📊 显示逻辑

### 场景1: 用户未填写人数（推荐）
**Markdown内容**：
```markdown
## 基本信息
- **天数**: 3天2夜
- **预算**: ¥500 - ¥800/人
```

**后端处理**：
- `people_count`: NULL（数据库允许为空）

**前端显示**：
```
苏州文化探索            [制定完成]
💰 ¥24,000  |  📅 2天1夜
                   ↑
              不显示人数
```

### 场景2: 用户手动添加人数（可选）
**Markdown内容**：
```markdown
## 基本信息
- **天数**: 3天2夜
- **人数**: 50人        ← 用户手动添加
- **预算**: ¥500 - ¥800/人
```

**后端处理**：
- 解析markdown提取`people_count`: 50

**前端显示**：
```
苏州豪华团建之旅        [制定完成]
💰 ¥10,000  |  👥 9人  |  📅 3天2夜
                  ↑
              显示人数
```

## 🔄 数据流转

### 完整流程
```
前端输入（无人数）
   ↓
{ markdown_content: "# 团建...\n- **天数**: 3天2夜\n..." }
   ↓
后端保存
   ↓
{
  plan_request_id: "...",
  markdown_content: "...",
  people_count: NULL  ← 允许为空
}
   ↓
AI解析markdown
   ↓
如果markdown中有人数 → 提取出来
如果markdown中无人数 → 保持NULL
   ↓
前端列表展示
   ↓
people_count为NULL → 不显示"👥 X人"
people_count有值    → 显示"👥 X人"
```

## 💡 设计理念

### 为什么移除人数？

1. **人数是动态的**
   - 报名阶段：人数不确定
   - 确认阶段：人数逐渐增加
   - 出行阶段：可能有人临时退出

2. **人数不影响方案**
   - 3天2夜的行程安排不因人数改变
   - 交通方式不因人数改变（除非包车）
   - 住宿安排不因人数改变（只影响房间数）

3. **后续统计更准确**
   - 人数应该通过报名系统统计
   - 不应该在方案阶段硬编码

### 什么时候需要人数？

**预算计算时**：
- 总预算 = 人均预算 × 人数
- 如果markdown中填写了人数，AI可以计算总预算
- 如果未填写，则只显示人均预算范围

## 🧪 测试验证

### 测试1: 无人数字段（推荐）
```
1. AI填充：3天 / 北京 / 青岛
2. 生成的markdown无"人数"行 ✅
3. 提交方案
4. 我的方案页不显示"null人" ✅
5. 显示: ¥24,000 | 📅 2天1夜
```

### 测试2: 手动添加人数（可选）
```
1. AI填充：3天 / 北京 / 青岛
2. 生成后手动添加一行：
   - **人数**: 50人
3. 提交方案
4. 我的方案页显示"50人" ✅
5. 显示: ¥10,000 | 👥 50人 | 📅 3天2夜
```

### 测试3: 历史方案（已有人数）
```
旧版本生成的方案（有people_count字段）
   ↓
我的方案页正常显示"👥 9人" ✅
   ↓
新版本生成的方案（无people_count字段）
   ↓
我的方案页不显示人数 ✅
```

## 📁 修改文件

| 文件 | 修改内容 | 行数 |
|------|---------|------|
| `pages/index/index.js` | 移除MARKDOWN_TEMPLATE中的人数 | -1行 |
| `pages/index/index.js` | 移除generateAITemplate中的人数 | -1行 |
| `pages/myplans/myplans.wxml` | 添加people_count判断 | +4行 |
| `test-ai-fill.js` | 移除测试脚本中的人数 | -1行 |

## 🎉 优化效果

### 用户体验
- ✅ 模板更简洁（减少1个字段）
- ✅ 无"null人"显示bug
- ✅ 可选择性添加人数
- ✅ 符合业务逻辑（人数动态统计）

### 技术实现
- ✅ 数据库允许people_count为NULL
- ✅ 前端正确处理NULL值
- ✅ 向后兼容（旧方案仍正常显示）

## 📝 业务规则

### 人数字段规则
1. **生成方案时**：不需要填写人数（可选）
2. **报名阶段**：通过报名系统统计人数
3. **确认阶段**：根据实际报名人数更新
4. **出行阶段**：最终人数确认

### 显示规则
```
IF people_count IS NULL:
  不显示"👥 X人"

IF people_count = 0:
  不显示"👥 X人"

IF people_count > 0:
  显示"👥 X人"
```

## 更新记录

**2026-01-16 17:15**
- ✅ 从默认模板移除人数字段
- ✅ 从AI生成函数移除人数字段
- ✅ 修复"我的方案"页null显示问题
- ✅ 添加people_count判断逻辑
- ✅ 更新测试脚本

---

**验证方式**: 在微信开发者工具中重新测试AI填充，确认：
1. 生成的markdown无"人数"行 ✅
2. "我的方案"页不显示"null人" ✅
