from __future__ import annotations

from src.services.markdown_converter import _fallback_convert_to_itinerary_markdown_v2


def test_fallback_convert_suzhou_sample_printable_and_structured():
    text = """è‹å·å¸¦å¨ƒè€äººä¸¤å¤©ä¸€æ™šæ—…æ¸¸æ”»ç•¥
è¡Œç¨‹å®‰æ’
ç¬¬ä¸€å¤©ï¼šå¤å…¸å›­æ—ä¸æ–‡åŒ–ä½“éªŒ
ä¸Šåˆï¼šæ‹™æ”¿å›­ï¼ˆ7:30-10:30ï¼‰
ä¸­å›½å››å¤§åå›­ä¹‹ä¸€ï¼Œå…¨å›­å±±æ°´è¦ç»•ï¼Œåº­é™¢é”™è½æœ‰è‡´ã€‚å»ºè®®é€‰æ‹©æœ€æ—©å…¥å›­æ—¶æ®µï¼Œé¿å¼€äººæµé«˜å³°ã€‚å›­å†…äº­å°æ¥¼é˜ã€å‡å±±æµæ°´æ„æˆç²¾ç¾ç”»å·ï¼Œé€‚åˆè€äººå’Œå­©å­æ…¢æ…¢æ¬£èµã€‚
ä¸­åˆï¼šè§‚å‰è¡—åˆé¤ï¼ˆ11:00-12:30ï¼‰
ä»æ‹™æ”¿å›­æ­¥è¡Œçº¦10åˆ†é’Ÿå¯è¾¾è§‚å‰è¡—ï¼Œè¿™é‡Œæ˜¯è‹å·ç¾é£Ÿèšé›†åœ°ã€‚æ¨èå“å°æ¾é¼ æ¡‚é±¼ã€æ¸…ç‚’è™¾ä»ç­‰è‹å¸®èœï¼Œè€äººå’Œå­©å­éƒ½èƒ½æ¥å—ã€‚
ä¸‹åˆï¼šè‹å·åšç‰©é¦†ï¼ˆ13:00-15:00ï¼‰
ç”±å»ºç­‘å¤§å¸ˆè´è¿é“­è®¾è®¡ï¼Œå…è´¹å‚è§‚ä½†éœ€æå‰1-7å¤©åœ¨\"è‹å·åšç‰©é¦†\"å®˜ç½‘æˆ–å¾®ä¿¡å…¬ä¼—å·é¢„çº¦ã€‚å‘¨ä¸€é—­é¦†ï¼Œè¯·é¿å¼€æ­¤æ—¥ã€‚
å‚æ™šï¼šå¹³æ±Ÿè·¯å†å²è¡—åŒºï¼ˆ15:30-17:30ï¼‰
\"ä¸€æ¡å¹³æ±Ÿè·¯ï¼ŒåŠéƒ¨å§‘è‹å²\"ï¼Œè¿™é‡Œæ˜¯ä¿å­˜æœ€å®Œå¥½çš„å¤è¡—ä¹‹ä¸€ã€‚å¯ä»¥ç§Ÿä¸€å¥—æ±‰æœæ‹ç…§ï¼Œæˆ–ä¹˜åæ‰‹æ‘‡èˆ¹ï¼ˆçº¦20åˆ†é’Ÿï¼‰æ„Ÿå—æ°´ä¹¡é£æƒ…ã€‚ï¼ˆå›¾7èµµå…ƒç« çƒ§è‚‰å¾ˆå¥½åƒï¼‰é˜¿å©†ç»¿è±†æ°´ä¸€è¨€éš¾å°½ğŸ˜‚
æ™šä¸Šï¼šé‡‘é¸¡æ¹–å¤œæ™¯ï¼ˆ18:30-20:00ï¼‰
ä»å¹³æ±Ÿè·¯æ‰“è½¦å‰å¾€é‡‘é¸¡æ¹–ï¼Œçº¦15åˆ†é’Ÿè½¦ç¨‹ã€‚å‚æ™šæ—¶åˆ†æ¹–é¢å€’æ˜ å¤•é˜³ï¼Œä¸œæ–¹ä¹‹é—¨ç¯å…‰ç’€ç’¨ï¼Œå¯ä»¥æ²¿æ¹–æ•£æ­¥æˆ–ä¹˜åæ¸¸èˆ¹ã€‚å‘¨äº”å‘¨å…­æ™š19:30/20:30æœ‰éŸ³ä¹å–·æ³‰è¡¨æ¼”ã€‚
ç¬¬äºŒå¤©ï¼šä¸Šåˆï¼šå¯’å±±å¯ºï¼ˆ9:00-11:00ï¼‰
\"å§‘è‹åŸå¤–å¯’å±±å¯ºï¼Œå¤œåŠé’Ÿå£°åˆ°å®¢èˆ¹\"ï¼Œè¿™åº§åƒå¹´å¤å¯ºæ–‡åŒ–åº•è•´æ·±åšã€‚é—¨ç¥¨20å…ƒï¼Œå¯ºé™¢å†…é¦™ç«é¼ç››ï¼Œåœ°é¢å¹³æ•´ï¼Œé€‚åˆè€äººæ¸¸è§ˆã€‚
ä¸­åˆï¼šå¯’å±±å¯ºé™„è¿‘ç”¨é¤ï¼ˆ11:30-12:30ï¼‰
æ¨èå“å°ç´ æ–‹é¢æˆ–åœ°é“è‹å¼é¢ç‚¹1äººå‡50-80å…ƒã€‚
ä¸‹åˆï¼šè´­ç‰©ï¼ˆæˆšè–‡æ——è¢å·¥å‚åº—(å’ŒåŸºå¹¿åœºåº—)
å’ŒåŸºå¹¿åœº4æ¥¼ï¼Œæœè£…ç»æµå®æƒ ï¼Œè¿™æ¬¡æ·˜åˆ°äº†ä¸¤ä»¶æ——è¢å’Œä¸€ä»¶å›½é£å¤–å¥—ï¼Œè¶…çº§å–œæ¬¢ï¼
ä½å®¿æ¨è
é¦–é€‰åŒºåŸŸï¼šè§‚å‰è¡—/å¹³æ±Ÿè·¯é™„è¿‘
è¿™é‡Œæ˜¯å¤åŸä¸­å¿ƒï¼Œåœ°é“1å·çº¿å’Œ4å·çº¿äº¤æ±‡ï¼Œå‰å¾€å„å¤§å›­æ—ã€åšç‰©é¦†ã€è€è¡—éƒ½éå¸¸æ–¹ä¾¿ï¼Œé¤é¥®é€‰æ‹©æå¤šã€‚æ¨èé…’åº—ï¼šè‹å·ä¸­å¿ƒå¤§é…’åº—ï¼ˆ368å…ƒèµ·ï¼‰ã€è‹å·æ–‡æ—…å§‘è‹å°é™¢Â·ä¸‡å¹´æ¡¥é…’åº—ï¼ˆ256å…ƒèµ·ï¼‰ã€‚
ç¾é£Ÿæ¨è
è‹å¸®èœè€å­—å·ï¼š
â€¢ æ¾é¹¤æ¥¼ï¼ˆè§‚å‰åº—ï¼‰ï¼šæ¾é¼ æ¡‚é±¼ã€æ¸…ç‚’è™¾ä»
â€¢ å¾—æœˆæ¥¼ï¼šå“æ²¹é³ç³Šã€èŸ¹ç²‰è±†è…
â€¢ å´é—¨äººå®¶ï¼šåœ°é“å®¶å¸¸è‹å¸®èœï¼Œä»·æ ¼å®æƒ 
ç‰¹è‰²å°åƒï¼š
â€¢ è‹å¼æ±¤é¢ï¼šåŒå¾—å…´ã€è£•å…´è®°çš„æ«é•‡å¤§è‚‰é¢
â€¢ ç³•ç‚¹ï¼šé»„å¤©æºç³•å›¢ã€é‡‡èŠæ–‹
â€¢ ç³–ç²¥ï¼šæ½˜ç‰éºŸç³–ç²¥é“º
å®ç”¨è´´å£«
1.äº¤é€šæ–¹å¼ï¼šè‹å·åœ°é“ä¾¿åˆ©ï¼Œå»ºè®®æ‰“è½¦
2.å„¿ç«¥ç…§é¡¾ï¼šè‹å·åšç‰©é¦†æä¾›å„¿ç«¥æ¨è½¦ï¼ˆå…è´¹ï¼‰ï¼Œå‡†å¤‡ä¸€äº›å°é›¶é£Ÿå®‰æŠšå­©å­æƒ…ç»ªã€‚#ä¸Šæœ‰å¤©å ‚ä¸‹æœ‰è‹æ­[è¯é¢˜]# #è‹å·ä¸ƒé‡Œå±±å¡˜è¡—[è¯é¢˜]# #è‹å·æ—…æ¸¸æ”»ç•¥[è¯é¢˜]#"""

    md = _fallback_convert_to_itinerary_markdown_v2(text)

    assert md.startswith("# è¡Œç¨‹å®‰æ’\n> ç‰ˆæœ¬: v2\n\n")
    assert "## Day 1ï¼ˆä»Šå¤©ï¼‰" in md
    assert "## Day 2ï¼ˆä»Šå¤©ï¼‰" in md
    assert "æ‹™æ”¿å›­" in md and "07:30 - 10:30" in md
    assert "è§‚å‰è¡—" in md and "11:00 - 12:30" in md
    assert "è‹å·åšç‰©é¦†" in md and "13:00 - 15:00" in md
    assert "å¹³æ±Ÿè·¯å†å²è¡—åŒº" in md and "15:30 - 17:30" in md
    assert "é‡‘é¸¡æ¹–å¤œæ™¯" in md and "18:30 - 20:00" in md
    assert "å¯’å±±å¯º" in md and "09:00 - 11:00" in md

